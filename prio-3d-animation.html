<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PRIO-GRID 3D Conflict Diffusion Animation</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #f8fafc;
            color: #1e293b;
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            overflow: hidden;
        }

        .container {
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .visualization-container {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .prio-grid-3d {
            width: 800px;
            height: 600px;
            perspective: 1200px;
            perspective-origin: 50% 50%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .grid-stack {
            position: relative;
            transform-style: preserve-3d;
            transform: rotateX(45deg) rotateY(-30deg) rotateZ(10deg);
        }

        .time-slice {
            position: absolute;
            width: 400px;
            height: 300px;
            transform-style: preserve-3d;
            opacity: 0.9;
        }

        .grid-layer {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            grid-template-rows: repeat(6, 1fr);
            gap: 2px;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
        }

        .grid-cell {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(0, 0, 0, 0.1);
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            transform-style: preserve-3d;
            position: relative;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        /* Heatmap colors - green to yellow to red */
        .conflict-0 { background: rgba(255, 255, 255, 0.9); }
        .conflict-1 { background: rgba(34, 197, 94, 0.3); }   /* Green */
        .conflict-2 { background: rgba(101, 163, 13, 0.4); }  /* Yellow-green */
        .conflict-3 { background: rgba(234, 179, 8, 0.5); }   /* Yellow */
        .conflict-4 { background: rgba(249, 115, 22, 0.6); }  /* Orange */
        .conflict-5 { background: rgba(239, 68, 68, 0.7); }   /* Red */
        .conflict-6 { background: rgba(153, 27, 27, 0.8); }   /* Dark red */

        /* 3D positioning for time slices */
        .slice-0 { transform: translateZ(0px); }
        .slice-1 { transform: translateZ(-100px); }
        .slice-2 { transform: translateZ(-200px); }



        /* Diffusion animation */
        .diffusing {
            animation: diffusion-pulse 2s ease-in-out infinite;
        }

        @keyframes diffusion-pulse {
            0%, 100% { 
                opacity: 0.9; 
                transform: scale(1);
            }
            50% { 
                opacity: 1; 
                transform: scale(1.05);
            }
        }

        /* Rotation animation for 3D effect */
        .auto-rotate {
            animation: rotate3d 20s linear infinite;
        }

        @keyframes rotate3d {
            0% { transform: rotateX(15deg) rotateY(-25deg); }
            25% { transform: rotateX(10deg) rotateY(-15deg); }
            50% { transform: rotateX(20deg) rotateY(-35deg); }
            75% { transform: rotateX(5deg) rotateY(-20deg); }
            100% { transform: rotateX(15deg) rotateY(-25deg); }
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .prio-grid-3d {
                height: 500px;
                perspective: 800px;
            }
            
            .time-slice {
                width: 300px;
                height: 225px;
            }
            
            .controls {
                flex-direction: column;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="visualization-container">
            <div class="prio-grid-3d">
                <div class="grid-stack" id="gridStack">
                    <!-- Time slices will be generated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const GRID_WIDTH = 8;
        const GRID_HEIGHT = 6;
        const TIME_SLICES = 3;
        const MAX_TIME = 60;

        // Animation state
        let currentTime = 0;
        let isPlaying = false;
        let animationSpeed = 1;
        let animationInterval;

        // Conflict data structure
        let conflictData = [];

        // Initialize the visualization
        function initializeVisualization() {
            createGridSlices();
            generateConflictData();
            updateVisualization();
        }

        // Create the 3D grid structure
        function createGridSlices() {
            const gridStack = document.getElementById('gridStack');
            gridStack.innerHTML = '';

            for (let slice = 0; slice < TIME_SLICES; slice++) {
                const timeSlice = document.createElement('div');
                timeSlice.className = `time-slice slice-${slice}`;
                timeSlice.id = `slice-${slice}`;

                const gridLayer = document.createElement('div');
                gridLayer.className = 'grid-layer';

                // Create grid cells
                for (let row = 0; row < GRID_HEIGHT; row++) {
                    for (let col = 0; col < GRID_WIDTH; col++) {
                        const cell = document.createElement('div');
                        cell.className = 'grid-cell conflict-0';
                        cell.id = `cell-${slice}-${row}-${col}`;
                        gridLayer.appendChild(cell);
                    }
                }

                timeSlice.appendChild(gridLayer);
                gridStack.appendChild(timeSlice);
            }
        }

        // Generate realistic conflict diffusion data
        function generateConflictData() {
            conflictData = [];

            for (let t = 0; t <= MAX_TIME; t++) {
                const timeStep = [];
                
                for (let slice = 0; slice < TIME_SLICES; slice++) {
                    const sliceData = [];
                    const timeOffset = t + slice * 10; // Each slice represents +10 time units
                    
                    for (let row = 0; row < GRID_HEIGHT; row++) {
                        const rowData = [];
                        
                        for (let col = 0; col < GRID_WIDTH; col++) {
                            // Simulate conflict diffusion from multiple epicenters
                            let conflictLevel = 0;
                            
                            // Primary epicenter (bottom-left)
                            const dist1 = Math.sqrt(Math.pow(row - 4, 2) + Math.pow(col - 1, 2));
                            const primary = Math.max(0, 6 - dist1 - timeOffset * 0.1);
                            
                            // Secondary epicenter (top-right) - starts later
                            const dist2 = Math.sqrt(Math.pow(row - 1, 2) + Math.pow(col - 6, 2));
                            const secondary = Math.max(0, 5 - dist2 - Math.max(0, timeOffset - 20) * 0.15);
                            
                            // Diffusion wave effect
                            const waveEffect = Math.sin(timeOffset * 0.2 - dist1 * 0.5) * 0.5 + 0.5;
                            
                            // Combine effects
                            conflictLevel = Math.max(primary, secondary) * 
                                          (0.7 + 0.3 * waveEffect) * 
                                          (timeOffset > 0 ? Math.min(1, timeOffset / 10) : 0);
                            
                            // Add some randomization
                            conflictLevel += (Math.random() - 0.5) * 0.5;
                            
                            // Clamp to valid range
                            conflictLevel = Math.max(0, Math.min(6, Math.floor(conflictLevel)));
                            
                            rowData.push(conflictLevel);
                        }
                        sliceData.push(rowData);
                    }
                    timeStep.push(sliceData);
                }
                conflictData.push(timeStep);
            }
        }

        // Update the visualization based on current time
        function updateVisualization() {
            const timeIndex = Math.floor(currentTime);
            
            for (let slice = 0; slice < TIME_SLICES; slice++) {
                for (let row = 0; row < GRID_HEIGHT; row++) {
                    for (let col = 0; col < GRID_WIDTH; col++) {
                        const cell = document.getElementById(`cell-${slice}-${row}-${col}`);
                        const conflictLevel = conflictData[timeIndex][slice][row][col];
                        
                        // Update cell appearance
                        cell.className = `grid-cell conflict-${conflictLevel}`;
                        
                        // Add diffusion animation for active conflicts
                        if (conflictLevel > 0 && Math.random() > 0.8) {
                            cell.classList.add('diffusing');
                        }
                    }
                }
            }
        }

        // Auto-play animation
        function startAnimation() {
            animationInterval = setInterval(() => {
                currentTime += animationSpeed * 0.3;
                if (currentTime >= MAX_TIME) {
                    currentTime = 0;
                }
                updateVisualization();
            }, 150);
        }

        // Mouse interaction for 3D rotation
        let isDragging = false;
        let startX, startY;
        let rotationX = 45, rotationY = -30, rotationZ = 10;

        document.addEventListener('mousedown', function(e) {
            if (e.target.closest('.prio-grid-3d')) {
                isDragging = true;
                startX = e.clientX;
                startY = e.clientY;
            }
        });

        document.addEventListener('mousemove', function(e) {
            if (isDragging) {
                const deltaX = e.clientX - startX;
                const deltaY = e.clientY - startY;
                
                rotationY += deltaX * 0.5;
                rotationX -= deltaY * 0.5;
                
                rotationX = Math.max(-60, Math.min(60, rotationX));
                
                const gridStack = document.getElementById('gridStack');
                gridStack.style.transform = `rotateX(${rotationX}deg) rotateY(${rotationY}deg) rotateZ(${rotationZ}deg)`;
                
                startX = e.clientX;
                startY = e.clientY;
            }
        });

        document.addEventListener('mouseup', function() {
            isDragging = false;
        });

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            initializeVisualization();
            startAnimation();
        });
    </script>
</body>
</html>