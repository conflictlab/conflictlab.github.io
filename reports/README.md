Forecasting Report — Developer Notes
====================================

Overview
- The 6‑month Forecasting Report is generated by Python code in `reports/generator/report.py` and compiled to PDF by the Overleaf LaTeX project under `reports/overleaf`.
- Figures are saved directly to `reports/overleaf/Fig_2025/` by the Python script. Tables and meta macros are written under `reports/overleaf/tables/` and `reports/overleaf/meta.tex`.
- The published PDF is copied to `public/newslettersAndReports/ForecastingReport_<Month Year>.pdf` and auto‑linked by the site’s Reports page.

Key paths
- Python generator: `reports/generator/report.py`
- Python env: `reports/generator/.venv` (or use project `.venv310`)
- Requirements: `reports/generator/requirements.txt`
- Overleaf project: `reports/overleaf/main_Fall_2025.tex`
- Figures: `reports/overleaf/Fig_2025/`
- Tables: `reports/overleaf/tables/`
- Meta macros: `reports/overleaf/meta.tex`

Environment
- `SKIP_VIEWS`, `SKIP_CF` (default 1): skip external benchmarks.
- `ARCHIVE_PRED_FILE`: path to archived 6‑month predictions CSV for historical runs.
- `MPLCONFIGDIR`: set to a writable directory (script uses `.mpl`).

Generate the latest report (manual)
1) Prepare inputs:
   - `npm run report:prepare`
2) Run Python (choose one):
   - `(cd reports/generator && ../../.venv310/bin/python report.py)`
   - `(cd reports/generator && python3 -m venv .venv && . .venv/bin/activate && pip install -r requirements.txt && python report.py)`
3) Compile PDF:
   - `(cd reports/overleaf && latexmk -pdf main_Fall_2025.tex)`
4) Publish:
   - `npm run report:publish` (uses publication/archive month by default)

Subtitle resolution when publishing
- Default (publication/archive month):
  1) `--archive=YYYY-MM` if provided
  2) Auto-detect by matching `Pred_df.csv` with an archive in `content/forecasts/csv`
  3) Fallback to forecast month (Pred_df.csv)
- Forecast month mode (`--title-source=forecast`):
  1) `reports/overleaf/meta.tex`: `\newcommand{\ReportSubtitle}{...}`
  2) Literal `\subtitle{...}` in LaTeX
  3) First date in `reports/generator/Pred_df.csv`

Batch/backfill
- All eligible archives: `npm run report:batch`
- Latest N: `npm run report:batch -- --latest=N`
- Monthly single: `npm run report:monthly`
- Eligible archives are those whose 6 forecast months are fully observed in `Hist.csv`.

Advanced batch options
- Since filter: `npm run report:batch -- --since=YYYY-MM` (only run archives from that month)
- Force mode (ignore eligibility): `npm run report:batch -- --force`
- Title source: `npm run report:batch -- --title-source=archive` to title by archive month (default is `forecast`, i.e., first forecast month)

Examples
- Backfill preliminary reports from May 2025 onward, titled by archive month:
  - `npm run report:batch -- --since=2025-05 --force --title-source=archive`

Notes
- `report.py` writes figures to Overleaf directly, so `report:sync-overleaf` is generally unnecessary (kept for flexibility if the output path changes).
- The LaTeX tables export requires `unicodedata` (already imported). Outputs: `metrics.tex`, `top_errors.tex`.
- External benchmarks (VIEWS/CF) are disabled by default to avoid network usage; enable by setting `SKIP_VIEWS=0 SKIP_CF=0`.
